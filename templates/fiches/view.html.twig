{% extends 'base.html.twig' %}

{% block title %}Techbase - {{ fiche.titre }}{% endblock %}

{% block body %}
<!-- Header -->
<div class="page-header-sticky flex justify-between items-center gap-4 flex-wrap">
  <h1 class="text-2xl font-bold text-gray-900">{{ fiche.titre }}</h1>
  <div class="flex gap-3">
    <a href="./?action=edit&id={{ fiche.id }}" class="inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition font-medium">
      <i class="fas fa-edit"></i>
      Modifier
    </a>
    <button onclick="confirmDelete()" class="inline-flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition font-medium">
      <i class="fas fa-trash"></i>
      Supprimer
    </button>
  </div>
</div>

<!-- Layout 75% / 25% -->
<div class="grid grid-cols-1 xl:grid-cols-12 gap-6">
  <!-- Colonne principale (75%) -->
  <div class="xl:col-span-9 space-y-6">
    <!-- Contenu -->
    <div class="bg-white p-6 rounded-lg border border-gray-200 shadow-sm">
      <div class="content-text">
        {% if fiche.description_html %}
          {{ fiche.description_html|raw }}
        {% else %}
          <span class="text-gray-500">Aucune description.</span>
        {% endif %}
      </div>
    </div>

    <!-- Tags -->
    <div class="bg-white p-6 rounded-lg border border-gray-200 shadow-sm">
      <h2 class="text-lg font-semibold text-gray-900 flex items-center gap-2 mb-4">
        <i class="fas fa-tags text-gray-400"></i>
        Tags
      </h2>
      {% if fiche.tags|length > 0 %}
        <div class="flex flex-wrap gap-2">
          {% for tag in fiche.tags %}
            <span class="inline-flex items-center px-3 py-1 bg-teal-50 text-primary rounded-full text-sm font-semibold border border-teal-200">
              {{ tag }}
            </span>
          {% endfor %}
        </div>
      {% else %}
        <span class="text-gray-500">Aucun tag.</span>
      {% endif %}
    </div>
  </div>

  <!-- Sidebar (25%) -->
  <div class="xl:col-span-3">
    <div class="bg-white p-6 rounded-lg border border-gray-200 shadow-sm space-y-4">
      <h2 class="text-lg font-semibold text-gray-900 flex items-center gap-2 mb-4">
        <i class="fas fa-info-circle text-gray-400"></i>
        Informations
      </h2>

      <div class="space-y-3">
        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg border border-gray-200">
          <span class="font-semibold text-gray-700 text-sm">Rubrique</span>
          <span class="text-gray-600 text-sm">
            {% if fiche.rubrique_nom %}
              {{ fiche.rubrique_nom }}
            {% else %}
              Sans rubrique
            {% endif %}
          </span>
        </div>

        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg border border-gray-200">
          <span class="font-semibold text-gray-700 text-sm">État</span>
          <span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-semibold {% if fiche.etat == 'À faire' %}bg-amber-100 text-amber-800{% elseif fiche.etat == 'En cours' %}bg-blue-100 text-blue-800{% else %}bg-green-100 text-green-800{% endif %}">
            {{ fiche.etat }}
          </span>
        </div>

        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg border border-gray-200">
          <span class="font-semibold text-gray-700 text-sm">Créée le</span>
          <span class="text-gray-600 text-sm flex items-center gap-1">
            <i class="fas fa-calendar-plus text-xs"></i>
            {{ fiche.created_at|date('d/m/Y') }}
          </span>
        </div>

        {% if fiche.updated_at != fiche.created_at %}
        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg border border-gray-200">
          <span class="font-semibold text-gray-700 text-sm">Modifiée le</span>
          <span class="text-gray-600 text-sm flex items-center gap-1">
            <i class="fas fa-calendar-edit text-xs"></i>
            {{ fiche.updated_at|date('d/m/Y') }}
          </span>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Modal de confirmation de suppression -->
<div id="deleteModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" onclick="if(event.target===this) closeDeleteModal()">
  <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
    <div class="flex justify-between items-center p-4 border-b border-gray-200">
      <h3 class="text-lg font-semibold text-gray-900">Confirmer la suppression</h3>
      <button type="button" onclick="closeDeleteModal()" class="text-gray-400 hover:text-gray-600 text-2xl leading-none">×</button>
    </div>

    <div class="p-6">
      <p class="text-gray-700">Êtes-vous sûr de vouloir supprimer la fiche <strong>{{ fiche.titre }}</strong> ?</p>
      <p class="text-gray-500 text-sm mt-4">Cette action est irréversible.</p>
    </div>

    <div class="flex justify-end gap-3 p-4 border-t border-gray-200 bg-gray-50 rounded-b-lg">
      <button type="button" onclick="closeDeleteModal()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition font-medium">
        Annuler
      </button>
      <a href="./?action=delete&id={{ fiche.id }}" class="inline-flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition font-medium">
        <i class="fas fa-trash"></i>
        Supprimer définitivement
      </a>
    </div>
  </div>
</div>

<script>
function confirmDelete() {
  document.getElementById('deleteModal').classList.remove('hidden');
  document.body.style.overflow = 'hidden';
}

function closeDeleteModal() {
  document.getElementById('deleteModal').classList.add('hidden');
  document.body.style.overflow = '';
}

document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape' && !document.getElementById('deleteModal').classList.contains('hidden')) {
    closeDeleteModal();
  }
});
</script>
{% endblock %}